<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ForensicFlow - File Recovery Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Add modern icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .glass-effect {
            background: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .file-card {
            transition: all 0.3s ease;
        }
        .file-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .gradient-text {
            background: linear-gradient(45deg, #9F7AEA, #7F9CF5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        #dropArea {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        #dropArea.active {
            border-color: #9F7AEA;
            background: rgba(159, 122, 234, 0.1);
        }
       
.container {
  display: flex;
  align-items: center;
  justify-content: center;
}

.loader {
  position: relative;
  width: 200px;
  height: 200px;
  perspective: 800px;
}

.crystal {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 60px;
  height: 60px;
  opacity: 0;
  transform-origin: bottom center;
  transform: translate(-50%, -50%) rotateX(45deg) rotateZ(0deg);
  animation: spin 4s linear infinite, emerge 2s ease-in-out infinite alternate,
    fadeIn 0.3s ease-out forwards;
  border-radius: 10px;
  visibility: hidden;
}

@keyframes spin {
  from {
    transform: translate(-50%, -50%) rotateX(45deg) rotateZ(0deg);
  }
  to {
    transform: translate(-50%, -50%) rotateX(45deg) rotateZ(360deg);
  }
}

@keyframes emerge {
  0%,
  100% {
    transform: translate(-50%, -50%) scale(0.5);
    opacity: 0;
  }
  50% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
  }
}

@keyframes fadeIn {
  to {
    visibility: visible;
    opacity: 0.8;
  }
}

.crystal:nth-child(1) {
  background: linear-gradient(45deg, #003366, #336699);
  animation-delay: 0s;
}

.crystal:nth-child(2) {
  background: linear-gradient(45deg, #003399, #3366cc);
  animation-delay: 0.3s;
}

.crystal:nth-child(3) {
  background: linear-gradient(45deg, #0066cc, #3399ff);
  animation-delay: 0.6s;
}

.crystal:nth-child(4) {
  background: linear-gradient(45deg, #0099ff, #66ccff);
  animation-delay: 0.9s;
}

.crystal:nth-child(5) {
  background: linear-gradient(45deg, #33ccff, #99ccff);
  animation-delay: 1.2s;
}

.crystal:nth-child(6) {
  background: linear-gradient(45deg, #66ffff, #ccffff);
  animation-delay: 1.5s;
}

    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white min-h-screen">
    <!-- Modern Navigation Bar -->
    <nav class="glass-effect sticky top-0 z-50 px-6 py-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-shield-alt text-purple-500 text-2xl"></i>
                <h1 class="text-3xl font-bold gradient-text">ForensicFlow</h1>
            </div>
            <div class="flex items-center space-x-6">
                <a href="/dashboard" class="text-gray-300 hover:text-white transition-colors">
                    <i class="fas fa-home mr-2"></i>Dashboard
                </a>
                <a href="#" class="text-gray-300 hover:text-white transition-colors">
                    <i class="fas fa-bell"></i>
                </a>
                <a href="#" class="text-gray-300 hover:text-white transition-colors">
                    <i class="fas fa-cog"></i>
                </a>
                <button onclick="logout()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-6 py-8">
        <h2 class="text-4xl font-bold mb-8 text-center">
            <span class="gradient-text">File Recovery Lab</span>
        </h2>

        <!-- Include Credit Status Component -->
        {% include 'credit_status.html' %}

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
            <!-- Tool Information Card -->
            <div class="glass-effect p-6 rounded-2xl col-span-1">
                <div class="flex items-center space-x-4 mb-6">
                    <div class="p-3 bg-purple-500 bg-opacity-20 rounded-lg">
                        <i class="fas fa-file-alt text-purple-400 text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-purple-400">File Recovery Lab</h3>
                        <p class="text-gray-400">Data Recovery & Analysis</p>
                    </div>
                </div>
                <div class="space-y-4">
                    <p class="text-gray-300">Upload disk images to recover deleted files using advanced forensic techniques.</p>
                    <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-purple-300 mb-2">Supported File Types:</h4>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-2 py-1 bg-purple-900 bg-opacity-40 rounded-full text-sm">MPG</span>
                            <span class="px-2 py-1 bg-purple-900 bg-opacity-40 rounded-full text-sm">PDF</span>
                            <span class="px-2 py-1 bg-purple-900 bg-opacity-40 rounded-full text-sm">GIF</span>
                            <span class="px-2 py-1 bg-purple-900 bg-opacity-40 rounded-full text-sm">JPG</span>
                            <span class="px-2 py-1 bg-purple-900 bg-opacity-40 rounded-full text-sm">DOCX</span>
                            <span class="px-2 py-1 bg-purple-900 bg-opacity-40 rounded-full text-sm">AVI</span>
                            <span class="px-2 py-1 bg-purple-900 bg-opacity-40 rounded-full text-sm">PNG</span>
                        </div>
                    </div>
                    <p class="text-yellow-300 text-sm"><i class="fas fa-info-circle mr-2"></i> Each recovery process costs 5 credits</p>
                </div>
            </div>

            <!-- Upload Area -->
            <div class="glass-effect p-6 rounded-2xl col-span-1 lg:col-span-2">
                <h3 class="text-xl font-semibold text-purple-400 mb-4">Upload Disk Image</h3>
                <div id="dropArea" class="p-8 rounded-xl text-center mb-6 cursor-pointer">
                    <i class="fas fa-upload text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-300 mb-2">Drag & drop your disk image here or</p>
                    <label for="diskImage" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors inline-block cursor-pointer">
                        Browse Files
                    </label>
                    <input type="file" id="diskImage" class="hidden" accept=".dd,.img,.001,.raw,.dmg,.bin">
                    <p class="text-gray-400 text-sm mt-2">Supported formats: .dd, .img, .001, .raw, .dmg, .bin</p>
                </div>
                <div id="uploadInfo" class="hidden">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <i class="fas fa-file-alt text-purple-400 mr-3 text-xl"></i>
                            <div>
                                <p id="fileName" class="text-white font-medium">diskimage.dd</p>
                                <p id="fileSize" class="text-gray-400 text-sm">10.5 MB</p>
                            </div>
                        </div>
                        <button id="removeFile" class="text-gray-400 hover:text-white">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <button id="startRecovery" class="w-full bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg transition-colors flex items-center justify-center">
                        <i class="fas fa-search mr-2"></i> Start Recovery Process
                    </button>
                </div>
                <div id="processingInfo" class="hidden">
                    <div class="flex items-center justify-center mb-4">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500"></div>
                    </div>
                    <p class="text-center text-gray-300">Processing your disk image...</p>
                    <p class="text-center text-gray-400 text-sm mt-2">This might take a few minutes depending on the file size.</p>
                </div>
            </div>
        </div>

        <!-- Results Area -->
        <div id="resultsArea" class="hidden">
            <h3 class="text-2xl font-semibold text-purple-400 mb-6 flex items-center">
                <i class="fas fa-list-ul mr-3"></i> Recovery Results
            </h3>
            
            <div class="bg-gray-800 bg-opacity-30 p-4 rounded-xl mb-6">
                <div class="flex flex-col md:flex-row md:items-center justify-between">
                    <div>
                        <p class="text-white"><span id="totalFilesFound">0</span> files recovered</p>
                        <p class="text-gray-400 text-sm"><span id="diskImageName">diskimage.dd</span> | <span id="processingTime">5.2</span> seconds</p>
                    </div>
                    <div class="flex gap-3 mt-4 md:mt-0">
                        <button id="downloadAllBtn" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors flex items-center">
                            <i class="fas fa-download mr-2"></i> Download All
                        </button>
                        <button id="generateReportBtn" class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg transition-colors flex items-center">
                            <i class="fas fa-file-pdf mr-2"></i> Generate Report
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="glass-effect p-4 rounded-xl mb-8">
                <div class="flex items-center justify-between mb-4">
                    <div class="relative w-full md:w-1/3">
                        <input type="text" placeholder="Search recovered files..." 
                               class="w-full bg-gray-800 bg-opacity-50 border border-gray-700 rounded-lg px-4 py-2 pl-10 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <div class="absolute left-3 top-2.5 text-gray-400">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    <div class="hidden md:flex gap-2">
                        <select class="bg-gray-800 bg-opacity-50 border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option>All File Types</option>
                            <option>Images (JPG, PNG, GIF)</option>
                            <option>Documents (PDF, DOCX)</option>
                            <option>Videos (MPG, AVI)</option>
                        </select>
                        <select class="bg-gray-800 bg-opacity-50 border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option>Sort by: File Name</option>
                            <option>Sort by: File Size</option>
                            <option>Sort by: File Type</option>
                        </select>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr class="text-left text-gray-400 border-b border-gray-700">
                                <th class="px-4 py-3">File Name</th>
                                <th class="px-4 py-3">Type</th>
                                <th class="px-4 py-3">Start Offset</th>
                                <th class="px-4 py-3">End Offset</th>
                                <th class="px-4 py-3">SHA-256 Hash</th>
                                <th class="px-4 py-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recoveredFilesList">
                            <!-- Files will be listed here dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <div id="noFilesFound" class="hidden text-center py-12">
                    <i class="fas fa-search text-4xl text-gray-500 mb-4"></i>
                    <p class="text-gray-300">No files were recovered from this disk image.</p>
                    <p class="text-gray-400 text-sm mt-2">Try uploading a different disk image.</p>
                </div>
            </div>
        </div>
    </div>
    <br>
    <br>
    <br>
    <br>
    <footer class="container mx-auto px-6 py-4 mt-8">
        <div class="text-center text-gray-400">
            <p>Â© 2025 ForensicFlow. All rights reserved.</p>
            <p class="text-sm mt-1">File Recovery Lab v1.0</p>
        </div>
    </footer>

    <script src="/static/js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dropArea = document.getElementById('dropArea');
            const fileInput = document.getElementById('diskImage');
            const uploadInfo = document.getElementById('uploadInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const removeFile = document.getElementById('removeFile');
            const startRecovery = document.getElementById('startRecovery');
            const processingInfo = document.getElementById('processingInfo');
            const resultsArea = document.getElementById('resultsArea');
            
            // Drag and drop functionality
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.classList.add('active');
            }
            
            function unhighlight() {
                dropArea.classList.remove('active');
            }
            
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                if (files.length) {
                    handleFiles(files[0]);
                }
            }
            
            fileInput.addEventListener('change', function() {
                if (this.files.length) {
                    handleFiles(this.files[0]);
                }
            });
            
            function handleFiles(file) {
                fileName.textContent = file.name;
                fileSize.textContent = formatBytes(file.size);
                dropArea.classList.add('hidden');
                uploadInfo.classList.remove('hidden');
            }
            
            removeFile.addEventListener('click', function() {
                fileInput.value = '';
                uploadInfo.classList.add('hidden');
                dropArea.classList.remove('hidden');
            });
            
            startRecovery.addEventListener('click', function() {
                // Check if user has enough credits
                fetch('/api/credit/use', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ amount: 5 }) // 5 credits for file recovery
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // If credits deducted successfully, start recovery
                        uploadInfo.classList.add('hidden');
                        processingInfo.classList.remove('hidden');
                        
                        // Prepare file for upload
                        const file = fileInput.files[0];
                        const formData = new FormData();
                        formData.append('disk_image', file);
                        
                        // Call the API
                        fetch('/api/file-recovery/analyze', {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => response.json())
                        .then(data => {
                            processingInfo.classList.add('hidden');
                            resultsArea.classList.remove('hidden');
                            
                            document.getElementById('totalFilesFound').textContent = data.total_files;
                            document.getElementById('diskImageName').textContent = file.name;
                            document.getElementById('processingTime').textContent = data.processing_time;
                            
                            const filesTable = document.getElementById('recoveredFilesList');
                            filesTable.innerHTML = '';
                            
                            if (data.files.length === 0) {
                                document.getElementById('noFilesFound').classList.remove('hidden');
                            } else {
                                document.getElementById('noFilesFound').classList.add('hidden');
                                
                                data.files.forEach(file => {
                                    const row = document.createElement('tr');
                                    row.className = 'border-b border-gray-700';
                                    row.innerHTML = `
                                        <td class="px-4 py-3">
                                            <div class="flex items-center">
                                                <i class="fas fa-file text-purple-400 mr-2"></i>
                                                ${file.name}
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">${file.extension.toUpperCase()}</td>
                                        <td class="px-4 py-3">${file.start_offset}</td>
                                        <td class="px-4 py-3">${file.end_offset}</td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center">
                                                <span class="text-xs truncate w-32">${file.hash.substring(0, 16)}...</span>
                                                <button class="ml-2 text-gray-400 hover:text-white" onclick="copyToClipboard('${file.hash}')">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex space-x-2">
                                                <button class="text-blue-400 hover:text-blue-300" onclick="downloadFile('${file.id}')">
                                                    <i class="fas fa-download"></i>
                                                </button>
                                                <button class="text-green-400 hover:text-green-300" onclick="viewFile('${file.id}')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </td>
                                    `;
                                    filesTable.appendChild(row);
                                });
                            }
                        })
                        .catch(error => {
                            processingInfo.classList.add('hidden');
                            dropArea.classList.remove('hidden');
                            alert('Error during file recovery: ' + error);
                        });
                    } else {
                        alert('Insufficient credits. Please purchase more credits to use this feature.');
                    }
                })
                .catch(error => {
                    alert('Error checking credits: ' + error);
                });
            });
            
            // Helper functions
            function formatBytes(bytes, decimals = 2) {
                if (bytes === 0) return '0 Bytes';
                
                const k = 1024;
                const dm = decimals < 0 ? 0 : decimals;
                const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
                
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                
                return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
            }
        });
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Hash copied to clipboard');
            });
        }
        
        function downloadFile(fileId) {
            window.location.href = `/api/file-recovery/download/${fileId}`;
        }
        
        function viewFile(fileId) {
            window.open(`/api/file-recovery/view/${fileId}`, '_blank');
        }
    </script>
</body>
</html> 